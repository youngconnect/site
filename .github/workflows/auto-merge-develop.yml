name: Auto PR para Main

on:
  push:
    branches:
      - develop

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Criar Pull Request
        uses: repo-sync/pull-request@v2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          source_branch: "develop"
          destination_branch: "main"
          pr_title: "ðŸš€ Deploy: develop â†’ main"
          pr_body: |
            ## MudanÃ§as
            Merge automÃ¡tico da branch `develop` para `main`
            
            ### Commits incluÃ­dos:
            ${{ github.event.head_commit.message }}
            
            ---
            _PR criado automaticamente pelo GitHub Actions_
          pr_label: "auto-merge,deploy"
          pr_allow_empty: false

      - name: Auto-merge PR
        uses: pascalgn/automerge-action@v0.16.4
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          MERGE_LABELS: "auto-merge"
          MERGE_METHOD: "squash"
          MERGE_COMMIT_MESSAGE: "pull-request-title"
          MERGE_RETRIES: 6
          MERGE_RETRY_SLEEP: 10000